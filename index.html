<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="息壤·X-TSOS — 三元状态操作系统 · Web版" />
  <title>息壤 · X-TSOS</title>

  <!-- 轻奢高级感字体 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- 引入拆分后的CSS文件 -->
  <link rel="stylesheet" href="src/assets/css/base.css" />
  <link rel="stylesheet" href="src/assets/css/animations.css" />
  <link rel="stylesheet" href="src/assets/css/layout.css" />
  <link rel="stylesheet" href="src/assets/css/components.css" />
  <link rel="stylesheet" href="src/assets/css/responsive.css" />
</head>
<body>
  <div class="top-bar">
    <button class="theme-toggle" id="themeToggle">🌙</button>
    <div class="user-row">
      <div class="avatar">息</div>
      <div class="greeting">早安，息壤</div>
    </div>
    <div class="guidance-quote">
      “你的热情如日中天，但别忘了脚下的土地。”
    </div>
  </div>

  <div class="main-content">
    <div class="compass-section">
      <div class="compass-container">
        <div class="compass-bg">
          <div class="inner-core">炎明岛<br/>隆起</div>
        </div>
      </div>
    </div>

    <div class="modules-section">
      <div class="module-card">
        <div class="module-title">观象入微</div>
        <div class="module-desc">重遇自己，本自具足</div>
      </div>
      <div class="module-card">
        <div class="module-title">心屿沙盘</div>
        <div class="module-desc">心可筑岛，屿自成境</div>
      </div>
      <div class="module-card">
        <div class="module-title">五时微修</div>
        <div class="module-desc">五时为信，微修为露</div>
      </div>
      <div class="module-card">
        <div class="module-title">四时共修</div>
        <div class="module-desc">四时轮转，心归息壤</div>
      </div>
      <div class="module-card">
        <div class="module-title">三元年鉴</div>
        <div class="module-desc">万物共生，息壤即你</div>
      </div>
    </div>
  </div>

  <div class="input-bar">
    <div class="input-wrapper">
      <textarea
        id="user-input"
        class="actual-input"
        placeholder="你说，我在。"
        rows="1"
        maxlength="200"
        onkeypress="handleKeyPress(event)"
      ></textarea>
      <button class="send-button" onclick="sendMessage()">发送</button>
    </div>
  </div>

  <!-- ========== 动态内容区域（熔断/测试/结果/年鉴）—— 仅新增，未改动原有结构 ========== -->
  <div id="dynamic-content" class="dynamic-section" style="display: none;">
    <div id="quiz-container"></div>
    <div id="result-container" style="display: none;"></div>
    <div id="yearbook-container" style="display: none; padding: 1.5rem;">
      <div class="module-card">
        <div class="module-title">📜 三元年鉴</div>
        <pre id="yearbook-text" style="white-space: pre-wrap; line-height: 1.6; margin-top: 1rem;"></pre>
        <button class="send-button" style="margin-top: 1.2rem;" onclick="window.showHomePage()">返回首页</button>
      </div>
    </div>
  </div>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    // 强制默认设置为亮色模式
    const savedTheme = localStorage.getItem('theme') || 'light';

    // 初始化主题（默认亮色）
    if (savedTheme === 'dark') {
      body.setAttribute('data-theme', 'dark');
      themeToggle.textContent = '☀️';
    } else {
      body.removeAttribute('data-theme');
      themeToggle.textContent = '🌙';
      localStorage.setItem('theme', 'light');
    }

    themeToggle.addEventListener('click', () => {
      const isDark = body.getAttribute('data-theme') === 'dark';
      if (isDark) {
        body.removeAttribute('data-theme');
        themeToggle.textContent = '🌙';
        localStorage.setItem('theme', 'light');
      } else {
        body.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '☀️';
        localStorage.setItem('theme', 'dark');
      }
    });

    function handleKeyPress(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    function sendMessage() {
      const input = document.getElementById('user-input');
      const message = input.value.trim();
      if (message.length > 0) {
        console.log(`用户消息: ${message}`);
        input.value = '';
        input.placeholder = "你说，我在。";
      } else {
        input.placeholder = "请输入您的消息...";
        setTimeout(() => {
          input.placeholder = "你说，我在。";
        }, 2000);
      }
    }

    // ===== 金属动态元素生成（金箔质感几何图形）=====
    function createMetalParticles() {
      // 创建8-12个金属粒子（金箔质感）
      const particleCount = Math.floor(Math.random() * 5) + 8;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'metal-particle';
        
        // 金属粒子大小
        const size = Math.floor(Math.random() * 80) + 50;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // 随机位置
        particle.style.left = `${Math.random() * 80 + 10}vw`;
        particle.style.top = `${Math.random() * 80 + 10}vh`;
        
        // 金属动画时长和延迟
        const duration = Math.floor(Math.random() * 30) + 50;
        const delay = Math.random() * 20;
        particle.style.animation = `floatMetal ${duration}s infinite ease-in-out ${delay}s`;
        
        document.body.appendChild(particle);
        
        // 动画结束后移除并重新创建
        setTimeout(() => {
          particle.remove();
          if (i % 3 === 0) {
            setTimeout(createMetalParticles, 80000);
          }
        }, (duration + delay) * 1000);
      }
    }

    // 页面加载时创建金属粒子
    window.addEventListener('load', () => {
      createMetalParticles();
    });
  </script>

  <!-- ========== 引入 X-TSOS 核心逻辑（含伦理熔断系统） ========== -->
  <script type="module" src="app.js"></script>
</body>
</html>
